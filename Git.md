# Git

## Git分布式版本控制工具

Git是世界上最先进的分布式版本控制系统，克隆一个项目的速度非常快

每个开发都可以从master上克隆一个本地版本库，就算没有网络，也可以提交代码到本地仓库、查看log、创建项目分支等等

每个版本库都可以创建无限个分支，分支是个完整的目录，且这个目录拥有完整的实际文件

### **1、概述**

##### 1.1、应用场景

> - 备份
>
> - 代码还原
>
> - 协同开发
>
> - 追溯问题代码的开发者和开发时间

##### 1.2、版本控制的方式

> - **集中式版本控制工具**：集中式版本控制工具，版本库是集中存放在中央服务器的，team里每个人work时从中央服务器下载代码，是必须联网才能工作，局域网或互联网。个人修改后然后提交到中央版本库。
>   - 举例：SVN和CVS
> - **分布式版本控制工具**：分布式版本控制系统没有“中央服务器”，每个人的电脑上都是一个完整的版本库，这样工作的时候，无需要联网了，因为版本库就在你自己的电脑上。多人协作只需要各自的修改推送给对方，就能互相看到对方的修改了。
>   - 举例：git

##### 1.3、Git工作流程

![image-20220907195610591](C:\Users\R\AppData\Roaming\Typora\typora-user-images\image-20220907195610591.png)

> 命令如下：
>
> clone（克隆）: 从远程仓库中克隆代码到本地仓库
> checkout （检出）:从本地仓库中检出一个仓库分支然后进行修订
> add（添加）: 在提交前先将代码提交到暂存区
> commit（提交）: 提交到本地仓库。本地仓库中保存修改的各个历史版本
> fetch (抓取) ： 从远程库抓取到本地仓库，不进行任何的合并动作，一般操作比较少。
> pull (拉取) ： 从远程库拉到本地库，自动进行合并(merge)，然后放到到工作区，相当于
> fetch+merge
> push（推送） : 修改完成后，需要和团队成员共享代码时，将代码推送到远程仓库

### 2、Git环境配置

##### 2.1.1、下载安装

[git安装](https://blog.csdn.net/mukes/article/details/115693833?ops_request_misc=%7B%22request%5Fid%22%3A%22166254859916800182757311%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=166254859916800182757311&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-115693833-null-null.142^v47^pc_rank_34_1,201^v3^control_1&utm_term=git安装&spm=1018.2226.3001.4187)

[Git - Downloading Package (git-scm.com)](https://git-scm.com/download/win)

##### 2.1.2、基本配置

- 打开git bash

```bash
git config --global user.name "username" # 设置用户名
git config --global user.email "email@example.com" # 设置邮箱
```

- 查看配置信息

```bash
git config --global user.name
git config --global user.email
```

#### 2.2、创建本地仓库

> 要使用Git对我们的代码进行版本控制，首先需要获得本地仓库
>
> 1. 在电脑的任意位置创建一个空目录（例如test）作为我们的本地Git仓库
> 2. 进入这个目录中，点击右键打开Git bash窗口
> 3. 执行命令`git init`
> 4. 如果创建成功后可在文件夹下看到隐藏的.git目录

ssh连接GitHub

```sh
ssh-keygen -t rsa -b 4096 -C "xxx@xxx.com"
```



#### 2.3 基础操作指令

Git工作目录下对于文件的修改(增加、删除、更新)会存在几个状态，这些修改的状态会随着我们执行Git的命令而发生变化。

![image-20220907203058914](C:\Users\R\AppData\Roaming\Typora\typora-user-images\image-20220907203058914.png)

##### 2.3.1 status查看修改的状态

- 作用：查看修改的状态（暂存区、工作区）

```bash
git status
```

##### 2.3.2 add添加工作区到暂存区

- 作用：添加工作区一个或多个文件的修改到暂存区

```bash
git add file.txt # 添加单个文件
git add . # 将所有修改加入暂存区
```

##### 2.3.3 commit提交暂存区到本地仓库

- 作用：提交暂存区内容到本地仓库的当前分支

```bash
git commit -m "XXX update(注释内容)"
```

##### 2.3.4 log查看提交日志

**配置别名**

  ```bash
  alias git-log='git log --pretty=oneline --all --graph --abbrev-commit' 
  ```

配置的别名`git-log`就包含了这些参数，所以后续可以直接使用指令`git-log`

- 作用:查看提交记录

- 命令形式：git log [option] 或者 git-log
  - —all 显示所有分支
  - —pretty=oneline 将提交信息显示为一行
  - —abbrev-commit 使得输出的commitId更简短
  - —graph 以图的形式显示
  


##### 2.3.5 版本回退

- 作用：版本切换

```bash
git reset --hard commitID # commitID 可以使用 git-log 或 git log 指令查看
```

- 查看历史操作记录 可以看到已经删除的记录

```bash
git reflog
```



##### 2.3.6 添加文件至忽略列表

一般我们总会有些文件无需纳入Git 的管理，也不希望它们总出现在未跟踪文件列表。 通常都是些自动生成的文件，比如**日志文件**，或者编译过程中创建的**临时文件**等。 在这种情况下，我们可以在工作目录中创建一个名为 `.gitignore `的文件（文件名称固定），列出要忽略的文件模式。

- 新建文件`file02.txt`, 加入`.gitignore`中

#### 2.4、分支

几乎所有的版本控制系统都以某种形式支持分支。 使用分支意味着你可以把你的工作从开发主线上分离开来进行重大的Bug修改、开发新的功能，以免影响开发主线。

##### 2.4.1 查看本地分支

```bash
git branch
```

##### 2.4.2 创建本地分支

```bash
git branch 分支名
```

##### 2.4.3 切换分支

```bash
git checkout 分支名
```

我们还可以直接切换到一个不存在的分支（创建并切换）：

```bash
git checkout -b 分支名
```

##### 2.4.4 合并分支

一个分支上的提交可以合并到另一个分支

```bash
git merge 分支名
```

2.4.5 删除分支

不能删除当前分支，只能删除其他分支

```bash
git branch -d 分支名 # 删除分支时，需要做各种检查
```

```bash
git branch -D 分支名 # 不做任何检查，强制删除
```

##### 2.4.6 解决冲突

当两个分支上对文件的修改可能会存在冲突，例如同时修改了同一个文件的同一行，这时就需要手动解决冲突，解决冲突步骤如下：

1. 处理文件中冲突的地方
2. 将解决完冲突的文件加入暂存区(add)
3. 提交到仓库(commit)

##### 2.4.7 开发中分支使用原则与流程

几乎所有的版本控制系统都以某种形式支持分支。 使用分支意味着你可以把你的工作从开发主线上分离开来进行重大的Bug修改、开发新的功能，以免影响开发主线。

在开发中，一般有如下分支使用原则与流程：

- master （生产） 分支：线上分支，主分支，中小规模项目作为线上运行的应用对应的分支；
- develop（开发）分支：是从master创建的分支，一般作为开发部门的主要开发分支，如果没有其他并行开发不同期上线要求，都可以在此版本进行开发，阶段开发完成后，需要是合并到master分支，准备上线。
- feature/xxxx分支：从develop创建的分支，一般是同期并行开发，但不同期上线时创建的分支，分支上的研发任务完成后合并到develop分支，之后该分支可以删除。
- hotfix/xxxx分支：从master派生的分支，一般作为线上bug修复使用，修复完成后需要合并到master、test、develop分支。

![img](https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img7/image-20220118170619389.png)

### 3、Git远程仓库

#### 3.1 常用的托管服务

前面我们已经知道了Git中存在两种类型的仓库，即本地仓库和远程仓库。那么我们如何搭建Git远程仓库呢？我们可以借助互联网上提供的一些代码托管服务来实现，其中比较常用的有GitHub、码云、GitLab等。

- GitHub（ 地址：https://github.com/ ）是一个面向开源及私有软件项目的托管平台，因为只支持Git 作为唯一的版本库格式进行托管，故名GitHub。

- 码云（地址： https://gitee.com/ ）是国内的一个代码托管平台，由于服务器在国内，所以相比于 GitHub，码云速度会更快。

- GitLab （地址： https://about.gitlab.com/ ）是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务，一般用于在企业、学校等内部网络搭建git私服。

#### 3.2 操作远程仓库

##### 3.2.1 添加远程仓库

**此操作是先初始化本地库，然后与已创建的远程库进行对接。**

- 命令：
  - 远端名称：默认是`origin`，取决于远端服务器设置
  - 仓库地址：从远端服务器获取此url

```bash
git remote add <远端名称> <仓库地址>
```

##### 3.2.2 查看远程仓库

```bash
git remote
```

##### 3.2.3 推送到远程仓库

```sh
git push [-f] [--set-upstream] [远端名称] [本地分支名][:远端分支名]
```

- `-f`  表示强制推送，**一般在公司内没有这个的使用权限**，否则容易冲掉远程仓库的所有代码
-  `--set-upstream` 推送到远端的同时，建立起和远端分支的关联关系。用于第一次推送时。
-  如果当前分支已经和远端分支关联，则可以省略分支名和远端名
- git push 将master分支推送到已关联的远端分支
- **如果远程分支名和本地分支名相同，则可以只写本地分支名**

```sh
git push origin master
```

#####  3.2.4 本地分支与远程分支的关联关系

```sh
git branch -vv
```

##### 3.2.5 从远程仓库克隆

```sh
git clone <仓库地址> [本地目录]
```

本地目录可以省略，会自动生成一个目录

##### 3.2.6 从远程仓库中抓取和拉取

远程分支和本地的分支一样，我们可以进行merge操作，只是需要先把远端仓库里的更新都下载到本地，再进行操作。

- 抓取命令：
  - 抓取指令就是将仓库里的更新都抓取到本地，不会进行合并
  - 如果不指定远端名称和分支名，则抓取所有分支。

```sh
git fetch [remote name] [branch name]
```

- 拉取命令：
  - 拉取指令就是将远端仓库的修改拉到本地并自动进行合并，等同于fetch+merge。
  - 如果不指定远端名称和分支名，则抓取所有并更新当前分支。

```sh
git pull [remote name] [branch name]
```

##### 3.2.7 解决合并冲突

在一段时间，A、B用户修改了同一个文件，且修改了同一行位置的代码，此时会发生合并冲突。

A用户在本地修改代码后优先推送到远程仓库，此时B用户在本地修订代码，提交到本地仓库后，也需要推送到远程仓库，此时B用户晚于A用户，**故需要先拉取远程仓库的提交，经过合并后才能推送到远端分支**，如下图所示。

![img](https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img7/image-20220119174403295.png)

在B用户拉取代码时，因为A、B用户同一段时间修改了同一个文件的相同位置代码，故会发生合并冲突。

**远程分支也是分支，所以合并时冲突的解决方式也和解决本地分支冲突相同相同**，在此不再赘述。
